!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define?define(b):a.tpl=b()}(this,function(){return{html:function(a,b){return this.func(a)(b)},func:function(a){var b=this._compile(a);return new Function("D","var _h='';function _w(s){ _h+=s;}"+b+"return _h;")},serv:function(a,b,c){var d=this;this.ajax(a,function(a){var e=d.html(a,b);c(e,a,b)})},render:function(a,b){var c,d,e,f,g;for("[object Function]"==Object.prototype.toString.call(a)&&(b=a,a=null),c=a||document.getElementsByTagName("script"),this._finish=b,d=[],e=c.length,f=0;e>f;f++)(a||"tpl"==c[f].getAttribute("type")&&null===c[f].getAttribute("norender"))&&d.push(c[f]);for(this._total=e=d.length,this._curr=0,f=0;e>f;f++)g=d[f],this._renderOne(g)},escapeHTML:function(a){return a.toString().replace(/[<>&"]/g,function(a){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[a]})},ajax:function(a,b){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(c.responseText)};try{c.open("GET",a,!0),c.send()}catch(d){}},_xssfunc:"tpl.escapeHTML",_compile:function(a){for(var f,g,b="",c=a.split("\n"),d=c.length,e=-1;++e<d;)g=c[e],g=g.replace(/^\s*((?:[\S\s]*\S)?)\s*$/,"$1"),f=g.charAt(0),b+="<"==f||"@"==f?this._parseLine(g):"!"==f&&"!"==g.charAt(1)?"_w('"+g.substr(2)+"');":"!"==f?this._parseLine(g.substr(1)):g;return b},_parseLine:function(a){var b=this;return"_w('"+a.replace(/'/g,"\\'").replace(/@(\{.+?\}|[\w\.\[\]\(\)\!]+)/g,function(a,c,d,e){return c=c.replace(/\\'/g,"'"),"\\"==e.charAt(d-1)?"@"+c:("{"==c.charAt(0)&&(c=c.substr(1,c.length-2)),"!"==c.charAt(c.length-1)?(c=c.substr(0,c.length-1),"'+("+c+") + '"):"'+ "+b._xssfunc+"("+c+") + '")})+"');"},_setToDom:function(a,b,c){var d=document.createElement(/MSIE \d\.0/.test(navigator.userAgent)?"div":"table"),e=a.parentNode,f=d.childNodes;for(d.innerHTML=this.func(b)(c);0!=f.length;)e.insertBefore(f[0],a)},_total:0,_curr:0,_finishCall:function(){this._curr++,this._curr==this._total&&this._finish&&this._finish(this._total)},_finish:function(){},_renderOne:function(a){var b=this,c=a.getAttribute("data-data-url"),d=a.getAttribute("data-tpl-url");d?c?this.ajax(c,function(c){var e=JSON.parse(c);b.ajax(d,function(c){b._setToDom(a,c,e),b._finishCall()})}):b.ajax(d,function(c){b._setToDom(a,c,{}),b._finishCall()}):c?b.ajax(c,function(c){var d=JSON.parse(c);b._setToDom(a,a.innerHTML,d),b._finishCall()}):(b._setToDom(a,a.innerHTML,{}),b._finishCall())}}});